<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–¥–∞—á</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <h1 class="header__title">
                <a href="/">üìã –ú–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–¥–∞—á</a>
            </h1>
            <nav class="header__nav">
                <a href="/" class="nav-link">–í—Å–µ –∑–∞–¥–∞—á–∏</a>
                <a href="/task/new" class="nav-link nav-link--primary">–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞</a>
            </nav>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <!-- –§–∏–ª—å—Ç—Ä—ã -->
            <div class="filters">
                <h2>–§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É:</h2>
                <form method="GET" action="/" class="filter-form">
                    <select name="filter" onchange="this.form.submit()" class="filter-select">
                        <option value="all" <%= filter === 'all' ? 'selected' : '' %>>–í—Å–µ –∑–∞–¥–∞—á–∏</option>
                        <option value="pending" <%= filter === 'pending' ? 'selected' : '' %>>–û–∂–∏–¥–∞—é—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</option>
                        <option value="in_progress" <%= filter === 'in_progress' ? 'selected' : '' %>>–í –ø—Ä–æ—Ü–µ—Å—Å–µ</option>
                        <option value="completed" <%= filter === 'completed' ? 'selected' : '' %>>–ó–∞–≤–µ—Ä—à–µ–Ω—ã</option>
                    </select>
                </form>
            </div>

            <!-- –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á -->
            <div class="tasks">
                <% if (tasks.length === 0) { %>
                    <div class="empty-state">
                        <h3>–ó–∞–¥–∞—á –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
                        <p>–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É</p>
                        <a href="/task/new" class="btn btn--primary">–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É</a>
                    </div>
                <% } else { %>
                    <div class="tasks-grid">
                        <% tasks.forEach(task => { %>
                            <div class="task-card task-card--<%= task.status %>">
                                <div class="task-card__header">
                                    <h3 class="task-card__title"><%= task.title %></h3>
                                    <span class="task-status task-status--<%= task.status %>">
                                        <% if (task.status === 'pending') { %>
                                            ‚è≥ –û–∂–∏–¥–∞–µ—Ç
                                        <% } else if (task.status === 'in_progress') { %>
                                            üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ
                                        <% } else if (task.status === 'completed') { %>
                                            ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∞
                                        <% } %>
                                    </span>
                                </div>
                                
                                <div class="task-card__body">
                                    <p class="task-card__description"><%= task.description %></p>
                                    
                                    <% if (task.dueDate) { %>
                                        <div class="task-card__due-date">
                                            üìÖ –°—Ä–æ–∫: <%= new Date(task.dueDate).toLocaleDateString('ru-RU') %>
                                        </div>
                                    <% } %>
                                    
                                    <% if (task.attachments && task.attachments.length > 0) { %>
                                        <div class="task-card__attachments">
                                            <h4>üìé –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:</h4>
                                            <ul class="attachments-list">
                                                <% task.attachments.forEach(attachment => { %>
                                                    <li>
                                                        <a href="/download/<%= attachment.filename %>" class="attachment-link">
                                                            <%= attachment.originalname %>
                                                        </a>
                                                    </li>
                                                <% }) %>
                                            </ul>
                                        </div>
                                    <% } %>
                                </div>
                                
                                <div class="task-card__actions">
                                    <a href="/task/<%= task.id %>/edit" class="btn btn--secondary">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                                    <form method="POST" action="/task/<%= task.id %>/delete" style="display: inline;" onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–¥–∞—á—É?')">
                                        <button type="submit" class="btn btn--danger">–£–¥–∞–ª–∏—Ç—å</button>
                                    </form>
                                </div>
                            </div>
                        <% }) %>
                    </div>
                <% } %>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 –ú–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–¥–∞—á. –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ1</p>
        </div>
    </footer>
</body>
</html>
